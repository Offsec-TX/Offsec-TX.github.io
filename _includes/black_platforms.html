<style>
.selected {
    color: #ff0000 !important;
    border-color: #ff0000 !important;
}
</style>

<div id="bin-search-wrapper">
    <ul id="bin-search-filters" class="filter-list">
        <h3>Platforms:</h3>
        {% for platform_pair in site.data.black_platforms %}
        {% assign platform_id = platform_pair[0] %}
        {% assign platform = platform_pair[1] %}
        <li>
            <input type="checkbox" id="{{ platform.label | downcase }}" name="platform_name" onclick='filterByPlatform(this, "{{ platform.label | downcase }}"); filterTestcasesByPlatform();'>
            <label id="{{ platform.label | downcase }}_label" for="{{ platform.label | downcase }}" data-title="{{ platform.description | replace: '\n', ' ' }}">{{ platform.label }}</label>
        </li>
        {% endfor %}
    </ul>
</div>

<script>
// Platform filter only for bin-table
function filterByPlatform(checkbox, platform) {
    platform = platform.toLowerCase();
    var rows = document.querySelectorAll('#bin-table tbody tr');
    var checkedPlatforms = [];
    document.querySelectorAll('input[name="platform_name"]:checked').forEach(cb => {
        checkedPlatforms.push(cb.id);
    });

    rows.forEach(row => {
        var rowPlatforms = row.getAttribute('data-platforms') || '';
        var show = checkedPlatforms.length === 0 || checkedPlatforms.some(p => rowPlatforms.includes(p));
        row.style.display = show ? '' : 'none';
    });
}

// Platform filter for testcases table
function filterTestcasesByPlatform() {
    // Adjust selector if your testcases table has a different id or structure
    var testRows = document.querySelectorAll('#testcases .test-row');
    if (testRows.length === 0) return; // No testcases table present

    var checkedPlatforms = [];
    document.querySelectorAll('input[name="platform_name"]:checked').forEach(cb => {
        checkedPlatforms.push(cb.id);
    });

    testRows.forEach(row => {
        var rowPlatforms = (row.getAttribute('data-platforms') || '').toLowerCase().split(',');
        var show = checkedPlatforms.length === 0 || checkedPlatforms.some(p => rowPlatforms.includes(p));
        row.style.display = show ? '' : 'none';
    });
}

// Search filter for bin-table
document.getElementById('bin-search').addEventListener('input', function () {
    var query = this.value.toLowerCase();
    var rows = document.querySelectorAll('#bin-table tbody tr');
    rows.forEach(row => {
        var filterText = row.innerText.toLowerCase();
        row.style.display = filterText.includes(query) ? '' : 'none';
    });
});

// Optionally, filter testcases on page load in case checkboxes are pre-checked
document.addEventListener('DOMContentLoaded', function () {
    filterTestcasesByPlatform();
});
</script>
